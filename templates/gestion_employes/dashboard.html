{% extends 'base.html' %}

<!-- Styles pour les boutons -->
{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #064e3b 0%, #1a1a1a 100%) !important;
        color: #ffffff;
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
    }

    .container-fluid {
        background: transparent !important;
        padding: 20px;
    }

    /* Navbar Styles */
    .navbar {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        position: relative !important;
        z-index: 1000 !important;
    }

    /* Dashboard Header */
    .dashboard-header {
        background: rgba(16, 185, 129, 0.1);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid #10b981;
        backdrop-filter: blur(10px);
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 0.5rem;
        text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }

    .dashboard-subtitle {
        color: #d1d5db;
        font-size: 1.1rem;
    }

    /* Stats Cards */
    .stats-card {
        background: rgba(0, 0, 0, 0.4);
        border: 2px solid #10b981;
        border-radius: 20px;
        padding: 2rem;
        height: 100%;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.1), transparent);
        transition: left 0.5s;
    }

    .stats-card:hover::before {
        left: 100%;
    }

    .stats-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
        border-color: #34d399;
    }

    .card-icon {
        font-size: 3rem;
        color: #10b981;
        margin-bottom: 1rem;
        text-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    }

    .card-title {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 1rem;
    }

    .display-6 {
        font-size: 3rem;
        font-weight: 800;
        color: #10b981;
        text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }

    /* Section Cards */
    .section-card {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid #10b981;
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }

    .section-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(16, 185, 129, 0.2);
    }

    .section-card .card-header {
        background: transparent;
        border: none;
        padding: 0 0 1rem 0;
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 0;
        text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
    }

    /* Table Styles */
    .table {
        background: #000000 !important;
        border-radius: 15px;
        overflow: hidden;
        color: #ffffff;
    }

    .table th {
        background: rgba(16, 185, 129, 0.2) !important;
        color: #ffffff;
        border: none;
        font-weight: 600;
        padding: 1rem;
    }

    .table td {
        background: #000000 !important;
        border: none;
        padding: 1rem;
        border-bottom: 1px solid rgba(16, 185, 129, 0.1);
        color: #ffffff;
    }

    .table tbody tr:hover {
        background: rgba(16, 185, 129, 0.1) !important;
    }

    .table tbody tr:hover td {
        background: rgba(16, 185, 129, 0.1) !important;
    }

    /* Badges */
    .badge {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
    }

    .bg-primary {
        background: linear-gradient(135deg, #10b981, #059669) !important;
    }

    .bg-info {
        background: linear-gradient(135deg, #34d399, #10b981) !important;
    }

    .bg-success {
        background: linear-gradient(135deg, #059669, #047857) !important;
    }

    .bg-warning {
        background: linear-gradient(135deg, #f59e0b, #d97706) !important;
    }

    .bg-secondary {
        background: linear-gradient(135deg, #6b7280, #4b5563) !important;
    }

    /* Buttons */
    .btn {
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
    }

    .btn-warning {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }

    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        color: white;
    }

    .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        color: white;
    }

    /* List Groups */
    .list-group {
        background: transparent;
    }

    .list-group-item {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(16, 185, 129, 0.2);
        color: #ffffff;
        transition: all 0.3s ease;
    }

    .list-group-item:hover {
        background: rgba(16, 185, 129, 0.1);
        border-color: #10b981;
        transform: translateX(10px);
    }

    /* Role Distribution Cards */
    .role-card {
        background: #000000 !important;
        border: 1px solid #10b981;
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .role-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);
    }

    .role-card .card-title {
        color: #10b981;
        font-weight: 600;
    }

    .role-card .card-text {
        color: #d1d5db;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in {
        animation: fadeInUp 0.6s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .dashboard-title {
            font-size: 2rem;
        }
        .stats-card {
            margin-bottom: 1rem;
        }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #10b981, #059669);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #059669, #047857);
    }
</style>
{% endblock %}

{% block title %}Liste des Utilisateurs{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Dashboard Header -->
    <div class="dashboard-header fade-in">
        <h1 class="dashboard-title">Gestion des Utilisateurs</h1>
        <p class="dashboard-subtitle">Vue d'ensemble des utilisateurs et de leurs statuts sur Lunzy Tech. </p>
    </div>
    <!-- Statistiques principales -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="stats-card fade-in">
                        <i class="fas fa-users card-icon"></i>
                        <h5 class="card-title">Total Utilisateurs</h5>
                        <p class="display-6">{{ total_profiles }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card fade-in">
                        <i class="fas fa-check-circle card-icon"></i>
                        <h5 class="card-title">Utilisateurs Actifs</h5>
                        <p class="display-6">{{ profiles_actifs }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card fade-in">
                        <i class="fas fa-times-circle card-icon"></i>
                        <h5 class="card-title">Utilisateurs Inactifs</h5>
                        <p class="display-6">{{ profiles_inactifs }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card fade-in">
                        <i class="fas fa-plane-departure card-icon"></i>
                        <h5 class="card-title">Utilisateurs en Congé</h5>
                        <p class="display-6">{{ profiles_conges }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card fade-in">
                        <i class="fas fa-user-tag card-icon"></i>
                        <h5 class="card-title">Nombre de Rôles</h5>
                        <p class="display-6">{{ nombre_roles }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques sur les rôles -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="section-card fade-in">
                <div class="card-header">
                    <h5 class="section-title">Distribution des Rôles</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for role in roles %}
                        <div class="col-md-4 mb-3">
                            <div class="role-card card">
                                <div class="card-body">
                                    <h6 class="card-title">{{ role.nom }}</h6>
                                    <p class="card-text">{{ role.utilisateurs.count }} utilisateurs</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Derniers Pointages -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="section-card fade-in">
                <div class="card-body">
                    <h5 class="section-title">Derniers Pointages</h5>
                    <div class="list-group">
                        {% for pointage in derniers_pointages %}
                        <a href="#" class="list-group-item list-group-item-action">
                            <i class="fas fa-clock me-2" style="color: #10b981;"></i>
                            {{ pointage.profile.user.get_full_name }} - {{ pointage.date }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Liste des utilisateurs -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="section-card fade-in">
                <div class="card-header">
                    <h5 class="section-title">Liste des utilisateurs</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nom complet</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Rôle</th>
                                    <th>Matricule</th>
                                    <th>Poste</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for utilisateur in utilisateurs %}
                                <tr data-user-id="{{ utilisateur.id }}">
                                    <td>{{ utilisateur.get_full_name }}</td>
                                    <td>{{ utilisateur.username }}</td>
                                    <td>{{ utilisateur.email }}</td>
                                    <td id="role-cell-{{ utilisateur.id }}">
                                        {% if utilisateur.username == 'superadmin' %}
                                        <span class="badge bg-primary px-2 py-1">
                                            <i class="fas fa-crown me-1"></i> Super Admin
                                        </span>
                                        {% elif utilisateur.profile and utilisateur.profile.role %}
                                        {% with role=utilisateur.profile.role %}
                                        {% if role.nom == 'admin' or role.nom == 'superadmin' %}
                                        <span class="badge bg-primary px-2 py-1">
                                            <i class="fas fa-user-shield me-1"></i>
                                            {{ role.nom|title }}
                                        </span>
                                        {% elif role.nom == 'manager' %}
                                        <span class="badge bg-info px-2 py-1">
                                            <i class="fas fa-user-tie me-1"></i>
                                            {{ role.nom|title }}
                                        </span>
                                        {% elif role.nom == 'rh' %}
                                        <span class="badge bg-success px-2 py-1">
                                            <i class="fas fa-users me-1"></i>
                                            {{ role.nom|title }}
                                        </span>
                                        {% elif role.nom == 'DG' %}
                                        <span class="badge bg-primary px-2 py-1">
                                            <i class="fas fa-crown me-1"></i>
                                            {{ role.nom }}
                                        </span>
                                        {% elif role.nom == 'Directeur IT' %}
                                        <span class="badge bg-info px-2 py-1">
                                            <i class="fas fa-laptop-code me-1"></i>
                                            {{ role.nom }}
                                        </span>
                                        {% elif role.nom == 'Réceptionniste' %}
                                        <span class="badge bg-success px-2 py-1">
                                            <i class="fas fa-headset me-1"></i>
                                            {{ role.nom }}
                                        </span>
                                        {% elif role.nom == 'Ouvrier' %}
                                        <span class="badge bg-secondary px-2 py-1">
                                            <i class="fas fa-hard-hat me-1"></i>
                                            {{ role.nom }}
                                        </span>
                                        {% else %}
                                        <span class="badge bg-secondary px-2 py-1">
                                            <i class="fas fa-user me-1"></i>
                                            {{ role.nom }}
                                        </span>
                                        {% endif %}
                                        {% endwith %}
                                        {% else %}
                                        <span class="badge bg-secondary px-2 py-1">
                                            <i class="fas fa-user me-1"></i>
                                            Aucun rôle
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td>{{ utilisateur.profile.matricule }}</td>
                                    <td>{{ utilisateur.profile.poste }}</td>
                                    <td>
                                        <span class="badge bg-{{ utilisateur.profile.get_statut_badge }}">
                                            {{ utilisateur.profile.get_statut_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="{% url 'gestion_employes:edit_utilisateur' utilisateur.id %}"
                                                class="btn btn-sm btn-warning me-1">
                                                <i class="fas fa-edit"></i> Modifier
                                            </a>
                                            <a href="{% url 'gestion_employes:delete_utilisateur' utilisateur.id %}"
                                                class="btn btn-sm btn-danger"
                                                onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')">
                                                <i class="fas fa-trash"></i> Supprimer
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pas de JavaScript nécessaire pour les liens directs
</script>
{% endblock %}